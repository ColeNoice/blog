name: è®¾ç½® Hugo ä¸»é¢˜

on:
  push:
    branches:
      - main
  workflow_dispatch:

# æˆäºˆ workflow å¿…è¦çš„æƒé™
permissions:
  contents: write

jobs:
  setup-theme:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºåšå®¢ä»“åº“
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          # ä¼˜å…ˆä½¿ç”¨ PAT_TOKENï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤çš„ GITHUB_TOKEN
          token: ${{ secrets.PAT_TOKEN || github.token }}

      - name: æ£€æŸ¥ä¸»é¢˜æ˜¯å¦å·²å­˜åœ¨
        id: check-theme
        run: |
          if [ -d "themes/PaperMod" ] && [ -n "$(ls -A themes/PaperMod 2>/dev/null)" ]; then
            echo "exists=true" >> $GITHUB_OUTPUT
            echo "âœ“ ä¸»é¢˜å·²å­˜åœ¨"
          else
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "âŠ˜ ä¸»é¢˜ä¸å­˜åœ¨ï¼Œéœ€è¦ä¸‹è½½"
          fi

      - name: ä¸‹è½½ PaperMod ä¸»é¢˜
        if: steps.check-theme.outputs.exists == 'false'
        run: |
          echo "ğŸ“¥ å¼€å§‹ä¸‹è½½ PaperMod ä¸»é¢˜..."

          # ç¡®ä¿ themes ç›®å½•å­˜åœ¨
          mkdir -p themes

          # å…‹éš†ä¸»é¢˜ï¼ˆæµ…å…‹éš†ä»¥å‡å°‘ä¸‹è½½æ—¶é—´ï¼‰
          git clone --depth 1 https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod

          # åˆ é™¤ .git ç›®å½•
          rm -rf themes/PaperMod/.git

          echo "âœ… ä¸»é¢˜ä¸‹è½½å®Œæˆ"

      - name: æäº¤ä¸»é¢˜æ–‡ä»¶
        if: steps.check-theme.outputs.exists == 'false'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add themes/PaperMod/

          if git diff --staged --quiet; then
            echo "ğŸ“­ æ²¡æœ‰éœ€è¦æäº¤çš„æ›´æ”¹"
            exit 0
          fi

          git commit -m "chore: æ·»åŠ  PaperMod ä¸»é¢˜ [skip ci]"
          git push

          echo "âœ… ä¸»é¢˜å·²æäº¤åˆ°ä»“åº“"

      - name: å®Œæˆ
        run: |
          echo "ğŸ‰ ä¸»é¢˜è®¾ç½®å®Œæˆ"
